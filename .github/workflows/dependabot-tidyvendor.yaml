name: Tidy vendor

on:
  push:
    branches:
      - dependabot-go_modules-**

jobs:
  cleandeps:
    name: "cleandeps"
    runs-on: ubuntu-latest
    steps:
      - name: "checkout code"
        uses: actions/checkout@v2

      - name: "setup go 1.15"
        uses: actions/setup-go@v2-beta
        with:
          go-version: "^1.15"

      - name: "vendor"
        run: go mod vendor

      - name: "tidy"
        run: go mod tidy

      - name: "commit and push"
        run: |
          if [ -z "$(git status -s)" ];
          then
            echo "nothing to commit";
          else
            git config user.email "github-actions@github.com";
            git config user.name github-actions;
            git add go.mod go.sum vendor;
            git commit -m 'vendor dependencies and tidy';
            git push https://$GITHUB_ACTOR:${{ secrets.GITHUB_TOKEN }}@github.com/$GITHUB_REPOSITORY.git;
          fi;
